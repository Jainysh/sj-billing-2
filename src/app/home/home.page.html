<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>
      शंखेश्वर ज्वेलर्स
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="resetForms()" fill="clear">
        <ion-icon name="refresh"></ion-icon>
      </ion-button>
    </ion-buttons>

  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-list>
    <ion-grid>
      <ion-row>
        <ion-col width-50>
          <ion-item>
            Voucher No: {{voucherNo}}
          </ion-item>
        </ion-col>
        <ion-col width-50>
          <ion-item>
            <ion-icon name="md-calendar"></ion-icon>
            <ion-datetime [(ngModel)]="today"></ion-datetime>
          </ion-item>
        </ion-col>
      </ion-row>
    </ion-grid>
    <form [formGroup]='itemForm'>
      <ion-item>
        <ion-label position="fixed">Name</ion-label>
        <ion-input autofocus="true" autocapitalize="words" formControlName="name" type="text"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="fixed">Address</ion-label>
        <ion-input autocapitalize="on" formControlName="address" type="text"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="fixed">Contact</ion-label>
        <ion-input inputmode="tel" minlength="10" formControlName="contact" type="number"></ion-input>
        <ion-button slot="end" fill="clear" (click)="toggleWhatsapp()">
          <ion-icon [color]="isWhatsapp? 'success' : 'medium'" name="logo-whatsapp" class="whatsapp-icon"> </ion-icon>

        </ion-button>
      </ion-item>
      <ion-card style="border: 1px; border-color: black" *ngIf="isNewBillingItem">
        <div style="padding-left : 6%; padding-right: 6%; padding-top: 3%; padding-bottom: 0px; margin-bottom: 0px">
          <ion-button size="default" [fill]="goldFill" (click)="categorySelected('Gold')" style="width:22%">
            Gold</ion-button>
          <ion-button size="default" [fill]="silverFill" (click)="categorySelected('Silver')" style="width:22%">Silver
          </ion-button>
          <ion-button size="default" [fill]="otherFill" (click)="categorySelected('')" style="width:22%">
            Other</ion-button>
          <ion-button size="default" fill="solid" color="dark" (click)="toggleBill()"
            style="width:22%; font-size: 100%">मोड़
          </ion-button>
        </div>

        <ion-item>
          <ion-label position="fixed">Description</ion-label>

          <ion-input #desc autocapitalize="on" formControlName="description" (keyup)="getSavedDescription(desc.value)"></ion-input>

          <ion-button *ngIf="category === 'Gold'" slot="end" fill="clear" (click)="comment()">
            <img [src]="is916Hallmark? '../../assets/imgs/916-enabled.png': '../../assets/imgs/916-disabled.png'"
              class="hallmark">
          </ion-button>
        </ion-item>

        <ion-list *ngIf="descriptions.length" class="search-results">
          <ion-item color="light" *ngFor="let d of descriptions" (click)="saveSearchedItem(d.description)">
            <i>
              {{d.description}}
            </i> </ion-item>
        </ion-list>

        <ion-item>
          <ion-label position="fixed">{{weightTag.checked? 'Gross' : 'Nett'}} Weight</ion-label>
          <ion-input formControlName="weight1" type="number"></ion-input>

          <ion-label style="float: right;">{{weightTag.checked? 'Less' : 'No Less'}}</ion-label>
          <ion-toggle slot="end" #weightTag></ion-toggle>
        </ion-item>

        <ion-item *ngIf="weightTag.checked">
          <ion-label position="fixed">Less Weight</ion-label>
          <ion-input formControlName="lessWeight" type="number"></ion-input>
        </ion-item>

        <ion-item *ngIf="weightTag.checked">
          <ion-label position="fixed">Nett Weight</ion-label>
          <ion-input formControlName="weight2" [value]="getWeight2() >= 0 ? getWeight2() : ''" type="number">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="fixed">Rate/gm</ion-label>
          <ion-input formControlName="rate" type="number"></ion-input>
        </ion-item>


        <ion-item>
          <ion-label position="fixed">Making</ion-label>
          <ion-input formControlName="making" type="number"></ion-input>
          <ion-label>{{makingRateTag.checked? 'nett' : '/gm'}}</ion-label>
          <ion-toggle slot="end" #makingRateTag></ion-toggle>
        </ion-item>

        <ion-item>
          <ion-label position="fixed">Amount</ion-label>
          <ion-input #amount [value]="getAmount(makingRateTag.checked, weightTag.checked) || ''"
            formControlName="amount" type="number"></ion-input>
        </ion-item>
        <ion-item *ngIf="amount.value">
          <ion-button size="default" class="ion-text-wrap" fill="solid"
            (click)="addNewItem(makingRateTag.checked, weightTag.checked)" style="width:45%">
            <ion-icon name="add"></ion-icon>
            &nbsp; New Item
          </ion-button>
          <ion-button size="default" class="ion-text-wrap" fill="outline"
            (click)="goToLessBill(makingRateTag.checked, weightTag.checked)" style="width:45%; font-size: 100%">
            <ion-icon name="remove"></ion-icon>
            &nbsp;मोड़
          </ion-button>
        </ion-item>
      </ion-card>

    </form>
    <ion-card *ngIf="!isNewBillingItem">
      <form [formGroup]='lessForm'>
        <ion-item color="dark">
          <ion-label>
            Old Less <ion-icon style="float:right" name="close" (click)="toggleBill()"></ion-icon>
          </ion-label>

        </ion-item>
        <ion-item>
          <ion-label position="fixed">Description</ion-label>
          <ion-input autocapitalize="on" formControlName="description" #oldDescription type="text"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="fixed">Amount</ion-label>
          <ion-input formControlName="amount" #oldValue type="number"></ion-input>
        </ion-item>

        <ion-button [disabled]="!oldValue.value" fill="solid" expand="full" (click)="addNewLess()">Save
        </ion-button>

        <!-- <ion-item>
          <ion-button size="default" class="ion-text-wrap" fill="solid"
            (click)="addNewItem(makingRateTag.checked, weightTag.checked)" style="width:45%">
            <ion-icon name="add"></ion-icon>
            &nbsp; New Item
          </ion-button>
          <ion-button size="default" class="ion-text-wrap" fill="outline"
            (click)="goToLessBill(makingRateTag.checked, weightTag.checked)" style="width:45%; font-size: 100%">
            <ion-icon name="remove"></ion-icon>
            &nbsp;मोड़
          </ion-button>
        </ion-item> -->
      </form>
    </ion-card>

    <div style="padding:0; margin:0" *ngIf="items.length">
      <ion-card *ngFor="let item of items">
        <ion-item>
          <ion-label class="ion-text-wrap">{{item.description}}</ion-label>
          <ion-label> {{item.nettWeight}} gm </ion-label>
          <ion-label>₹ {{item.amount}} </ion-label>

          <!-- <ion-button fill="clear" size="default" color="dark">
            <ion-icon name="create"></ion-icon>
          </ion-button> -->
          <ion-button (click)="deleteItem(item)" fill="clear" size="default" color="dark">
            <ion-icon name="trash"></ion-icon>
          </ion-button>

        </ion-item>
      </ion-card>
    </div>

    <div style="margin:0;padding: 0;" *ngIf="lesses.length">
      <ion-card *ngFor="let less of lesses">
        <ion-item style="color: brown">
          मोड़&nbsp;
          <ion-label class="ion-text-wrap">{{less.description}}</ion-label>
          <ion-label class="ion-text-end">₹ {{less.amount}} </ion-label>

          <!-- <ion-button fill="clear" size="default" color="dark">
            <ion-icon name="create"></ion-icon>
          </ion-button> -->
          <ion-button (click)="deleteLess(less)" fill="clear" size="default" color="dark">
            <ion-icon name="trash"></ion-icon>
          </ion-button>

        </ion-item>
      </ion-card>
    </div>

    <ion-item *ngIf="lesses.length || items.length">
      <ion-label>Total Bill Amount (₹)</ion-label>
      <ion-label class="ion-text-end">{{getTotalAmount()}}</ion-label>
    </ion-item>

    <ion-item>
      <ion-label>Paid Amount (₹)</ion-label>
      <ion-input style="text-align: right" color="secondary" #paidAmount type="number" [value]="getTotalAmount()">
      </ion-input>
    </ion-item>


    <ion-grid *ngIf="getTotalAmount() - paidAmount.value > 0" class="ion-no-padding">
      <ion-row>
        <ion-col width-65>
          <ion-item>
            <ion-label>Balance</ion-label>
            <ion-input style="text-align: right" type="number" [value]="getTotalAmount() - paidAmount.value">
            </ion-input>
          </ion-item>
        </ion-col>
        <ion-col width-30>
          <ion-item>
            <ion-label>{{ billClear ? 'Its Okay!' : 'Pending'}}</ion-label>
            <ion-toggle slot="end" [(ngModel)]="billClear"></ion-toggle>
          </ion-item>
        </ion-col>
      </ion-row>
    </ion-grid>

    <ion-button [disabled]="!(lesses.length || items.length)" fill="solid" expand="full" class="ion-text-wrap"
      (click)="finishBilling(paidAmount.value)">
      <ion-icon name="checkmark"></ion-icon>&nbsp; Finish Billing
    </ion-button>

  </ion-list>
</ion-content>



<!--  


*******  IONIC V4 categorySelected

<ion-content>

  <ion-list>
    <ion-grid>
      <ion-row>
        <ion-col width-50>
          <ion-item>
            Voucher {{mystring}} Number: {{voucherNo}}
          </ion-item>
        </ion-col>
        <ion-col width-50>
          <ion-item>
            <ion-datetime [(ngModel)]="today"></ion-datetime>
          </ion-item>
        </ion-col>
      </ion-row>
    </ion-grid>
    <ion-item>
      <ion-label position="floating">Name</ion-label>
      <ion-input #name type="text"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label position="floating">Address</ion-label>
      <ion-input #address type="text" [value]="custAddress"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label position="floating">Contact</ion-label>
      <ion-input #contact type="number"></ion-input>
    </ion-item>

    <form [formGroup]='itemForm'>

      <ion-card>
        <ion-item>
          <ion-button size="default" fill="outline" (click)="categorySelected('Gold')" style="width:30%">Gold</ion-button>
          <ion-button size="default" fill="outline" (click)="categorySelected('Silver')" style="width:30%">Silver</ion-button>
          <ion-button size="default" fill="solid" (click)="categorySelected('')" style="width:30%">Other</ion-button>
        </ion-item>

        <ion-item>
          <ion-label>Description</ion-label>
          <ion-input formControlName="description"></ion-input>
        </ion-item>

        <ion-grid class="ion-no-padding">
          <ion-row>
            <ion-col width-45>
              <ion-item>
                <ion-label>Weight</ion-label>
                <ion-input #weight1 formControlName="weight1" type="number"></ion-input>
              </ion-item>
            </ion-col>
            <ion-col width-50>
              <ion-item>
                <ion-label clear default ion-button>{{weightTag.value? 'Nett Wt' : 'Less'}}</ion-label>
                <ion-toggle slot="end" #weightTag></ion-toggle>
              </ion-item>
            </ion-col>
          </ion-row>

          <ion-row *ngIf="weightTag.value">
            <ion-item>
              <ion-label>Less Weight</ion-label>
              <ion-input #lessWeight formControlName="lessWeight" type="number"></ion-input>
            </ion-item>
          </ion-row>
          <ion-row>
            <ion-item *ngIf="weightTag.value">
              <ion-label>Nett Weight</ion-label>
              <ion-input #weight2 formControlName="weight2" type="number"></ion-input>
            </ion-item>
          </ion-row>
        </ion-grid>
        <ion-item>
          <ion-label>Rate/gm</ion-label>
          <ion-input #rate formControlName="rate" [value]="categoryRate ? categoryRate : ''" type="number"></ion-input>
        </ion-item>
        <ion-grid class="ion-no-padding">
          <ion-row>
            <ion-col width-45>
              <ion-item>
                <ion-label>Making</ion-label>
                <ion-input #making formControlName="making" type="number"></ion-input>
              </ion-item>
            </ion-col>

            <ion-col width-50>
              <ion-item>
                <ion-label clear default ion-button>{{makingRateTag.value? 'nett' : 'per gm'}}</ion-label>
                <ion-toggle slot="end" #makingRateTag></ion-toggle>
              </ion-item>
            </ion-col>
          </ion-row>
        </ion-grid>

        <ion-item>
          <ion-label>Amount</ion-label>
          <ion-input #amount formControlName="amount"
            [value]="getAmount(weight1.value,lessWeight.value,weight2.value,rate.value,making.value,tag.value) || ''"
            type="number"></ion-input>
        </ion-item>

        <ion-item *ngIf="amount.value">
          <ion-button default class="ion-text-wrap" outline (click)="addDiscount()" style="width:30%; font-size: 100%">
            <ion-icon name="remove"></ion-icon>
            &nbsp; मोड़
          </ion-button>
          <ion-button default class="ion-text-wrap" solid (click)="addNewItem()" style="width:30%">
            <ion-icon name="add"></ion-icon>
            New Item
          </ion-button>
          <ion-button default class="ion-text-wrap" clear (click)="finishBilling()" style="width:30%">
            <ion-icon name="checkmark"></ion-icon>&nbsp; Finish Billing
          </ion-button>
        </ion-item>
      </ion-card>

    </form>


  </ion-list>

  <ion-item>
    <ion-label>
      Item
    </ion-label>
  </ion-item>


  <ion-label>
    <ion-button  expand="full" (click)='addBill()'>Toggle Menu</ion-button>
  </ion-label>
</ion-content> -->